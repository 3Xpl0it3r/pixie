# Generated file: bazel run //templates/skaffold:skaffoldtemplate
# DO NOT EDIT
apiVersion: skaffold/v1beta8
kind: Config
build:
  # In nightly cluster we pass in the tag for the image.
  # TODO(zasgar): This is probably similar to staging clusters in general
  # and we should probably generalize this.
  {{ if (eq .Deployment "nightly") }}
  tagPolicy:
    envTemplate:
      template: "{{`{{.IMAGE_NAME}}:{{.PL_IMAGE_TAG}}`}}"
  {{ end }}
  artifacts:
  - image: gcr.io/pl-dev-infra/agent_image
    context: .
    bazel:
      target: //src/vizier/services/agent:agent_image.tar
  - image: gcr.io/pl-dev-infra/vizier_metadata
    context: .
    bazel:
      target: //src/vizier/services/metadata:vizier_metadata_image.tar
  - image: gcr.io/pl-dev-infra/api_server_image
    context: .
    bazel:
      target: //src/services/api:api_server_image.tar
  - image: gcr.io/pl-dev-infra/vizier_query_broker
    context: .
    bazel:
      target: //src/vizier/services/query_broker:vizier_query_broker_image.tar
  - image: gcr.io/pl-dev-infra/api_server_image
    context: .
    bazel:
      target: //src/services/api:api_server_image.tar
  - image: gcr.io/pl-dev-infra/proxy_image
    context: .
    bazel:
      target: //src/services/proxy:proxy_prod_image.tar
  {{ if (eq .Deployment "nightly") }}
  - image: gcr.io/pl-dev-infra/customer_docs_prod_image
    context: .
    bazel:
      target: //docs/customer:customer_docs_prod_image.tar
  {{ end }}
  local:
    push: {{.PushArtifacts}}
deploy:
  kubectl:
    manifests:
    - {{.BuildDir}}/src/vizier/services/agent/agent_{{.Deployment}}.yaml
    - {{.BuildDir}}/src/vizier/services/query_broker/service_{{.Deployment}}.yaml
    - {{.BuildDir}}/src/vizier/services/metadata/service_{{.Deployment}}.yaml
    - {{.BuildDir}}/src/services/api/service_{{.Deployment}}.yaml
    - {{.BuildDir}}/src/services/api/service_{{.Deployment}}.yaml
    - {{.BuildDir}}/src/services/proxy/service_{{.Deployment}}.yaml
    {{ if (eq .Deployment "nightly") }}
    - {{.BuildDir}}/docs/customer/service_{{.Deployment}}.yaml
    {{ end }}
