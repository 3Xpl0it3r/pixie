apiVersion: v1
kind: Pod
metadata:
  name: stirling
  namespace: pl-{{USER}}
  labels:
    app: pl-test
spec:
  containers:
  - name: stirling
    image: gcr.io/pl-dev-infra/stirling_wrapper:{{USER}}
    imagePullPolicy: Always
    resources:
      limits:
        memory: 256Mi
      requests:
        cpu: 100m
        memory: 256Mi
    securityContext:
      capabilities:
        add:
          - SYS_PTRACE
          - SYS_ADMIN
      privileged: true
    volumeMounts:
       - name: proc
         mountPath: /host/proc
         readOnly: true
       - name: sys
         mountPath: /sys
         readOnly: true
       - name: usr
         mountPath: /host/usr
         readOnly: true
       - name: lib
         mountPath: /host/lib
         readOnly: true
  terminationGracePeriodSeconds: 30
  restartPolicy: Never
  volumes:
      - name: proc
        hostPath:
            path: /proc
            type: Directory
      - name: sys
        hostPath:
            path: /sys
            type: Directory
      - name: usr # for /usr/src (linux headers)
        hostPath:
            path: /usr
            type: Directory
      - name: lib # for /lib/modules (linux headers)
        hostPath:
            path: /lib
            type: Directory
